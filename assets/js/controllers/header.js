"use strict";app.directive("addCash",["$localStorage","$sessionStorage","appDB","$location","toastr",function(e,o,t,a,n){return{restrict:"E",controller:"headerController",templateUrl:"addCashPopup.php",link:function(a,s,i){a.openBolt=function(){bolt.launch({key:a.payUData.MerchantKey,txnid:a.payUData.TransactionID,hash:a.payUData.Hash,amount:a.payUData.Amount,firstname:a.payUData.FirstName,email:a.payUData.Email,phone:a.payUData.PhoneNumber,productinfo:a.payUData.ProductInfo.toString(),surl:a.payUData.SuccessURL,furl:a.payUData.FailedURL,lastname:"",curl:"",address1:"",address2:"",city:"",state:"",country:"",zipcode:"",udf1:"",udf2:"",udf3:"",udf4:"",udf5:"",pg:"",enforce_paymethod:"",expirytime:""},{responseHandler:function(s){if("SUCCESS"==s.response.txnStatus)var i="Success";else if("CANCEL"==s.response.txnStatus)i="Cancelled";else i="Failed";var r={SessionKey:e.user_details.SessionKey,PaymentGateway:"PayUmoney",PaymentGatewayStatus:i,WalletID:a.payUData.ProductInfo.toString(),PaymentGatewayResponse:JSON.stringify(s.response)};t.callPostForm("wallet/confirm",r).then(function(t){if(200==t.ResponseCode){e.user_details.WalletAmount=parseFloat(t.Data.WalletAmount).toFixed(2),delete o.CouponGUID,"Cancelled"==i&&(window.location.href=base_url+"myAccount?status=Cancelled"),"Success"==i&&(window.location.href=base_url+"myAccount?status=Success");var a=n.success(t.Message,{closeButton:!0});n.refreshTimer(a,5e3)}else{window.location.href=base_url+"myAccount?status=Failed";a=n.error(t.Message,{closeButton:!0});n.refreshTimer(a,5e3)}},function(e){console.log("error",e)})},catchException:function(e){alert(e.message)}})}}}}]),app.controller("headerController",["$scope","$rootScope","$location","environment","$localStorage","$sessionStorage","appDB","$sce","toastr","socialLoginService","$http","$timeout",function(e,o,t,a,n,s,i,r,l,u,c,d){n.hasOwnProperty("GamesType")&&n.GamesType?(e.GamesType=n.GamesType,"Football"==n.GamesType?o.apiPrefix="football/":o.apiPrefix=""):(e.GamesType="Cricket",o.apiPrefix="",n.GamesType=e.GamesType),e.gameTypeSelection=function(t){delete n.MatchGUID,delete n.SeriesGUID,e.GamesType=t,n.GamesType=t,"Football"==n.GamesType?o.apiPrefix="football/":o.apiPrefix="",window.location.href=base_url+"lobby",d(function(){location.reload()},500)},e.env=a,e.paymentMode="payu",e.headerActiveMenu="lobby";var m=window.location.pathname.split("/"),p=m[2];"www.fsl11.com"==window.location.host&&(p=m[1]),e.type=getQueryStringValue("type"),e.secondLevelLocation=p,e.base_url=base_url,"lobby"==e.secondLevelLocation||"league"==e.secondLevelLocation||"createTeam"==e.secondLevelLocation||"leagueCenter"==e.secondLevelLocation||"showContest"==e.secondLevelLocation?"Cricket"==n.GamesType?e.headerActiveMenu="lobbyCricket":e.headerActiveMenu="lobbyFootball":"auction"==e.secondLevelLocation||"createAuctionTeam"==e.secondLevelLocation||"auctionLeague"==e.secondLevelLocation||"auctionLeagueCenter"==e.secondLevelLocation||"showAuctionContest"==e.secondLevelLocation?e.headerActiveMenu="auction":"snakeDraft"==e.secondLevelLocation||"createSnakeDraftTeam"==e.secondLevelLocation||"snakeLeague"==e.secondLevelLocation||"draftLeagueCenter"==e.secondLevelLocation||"showDraftContest"==e.secondLevelLocation?e.headerActiveMenu="snakeDraft":e.headerActiveMenu=p,e.goToLogin=function(o){n.loginPage=o,"authenticate"!=e.secondLevelLocation&&(window.location.href=base_url+"authenticate")},n.hasOwnProperty("user_details")&&1==n.isLoggedIn&&(e.user_details=n.user_details,e.isLoggedIn=n.isLoggedIn,e.base_url=base_url,e.referral_url=base_url+n.user_details.ReferralCode,o.resetPromo=function(o){o||(e.PromoCodeFlag=!1,e.PromoCode="",e.GotCashBonus=0,e.CouponData={})},e.PromoCodeFlag=!1,e.PromoCode="",e.GotCashBonus=0,e.CouponData={},e.applyPromoCode=function(o,t){e.PromoCode=o;var a={};a.SessionKey=n.user_details.SessionKey,a.CouponCode=e.PromoCode,a.Amount=t,i.callPostForm("store/validateCoupon",a).then(function(o){if(200==o.ResponseCode&&(e.PromoCodeFlag=!0,e.CouponData=o.Data,"Percentage"==e.CouponData.CouponType?e.GotCashBonus=e.CouponData.CouponValue/100*e.amount:e.GotCashBonus=e.CouponData.CouponValue,s.CouponGUID=e.CouponData.CouponGUID),500==o.ResponseCode){var t=l.warning(o.Message,{closeButton:!0});l.refreshTimer(t,5e3)}if(502==o.ResponseCode){t=l.warning(o.Message,{closeButton:!0});l.refreshTimer(t,5e3),setTimeout(function(){localStorage.clear(),window.location.reload()},1e3)}},function(e){var o=l.warning(e.Message,{closeButton:!0});l.refreshTimer(o,5e3)})},e.removeCoupon=function(){e.PromoCodeFlag=!1,e.PromoCode="",e.GotCashBonus=0,e.CouponData={},delete s.CouponGUID},e.addMoreCash=function(o){e.removeCoupon(),e.amount=e.amount?e.amount:0,e.amount=Number(e.amount)+o},e.cashSubmitted=!1,e.selectPaymentMode=function(t,a){return e.cashSubmitted=!0,!!a.$valid&&(parseFloat(t)<parseInt(o.MinimumDepositAmount)?(e.errorAmount=!0,e.errorAmountMsg="Min limit of deposit amount is "+o.MinimumDepositAmount,!1):(e.isWalletSubmitted=!1,a.$valid?parseFloat(e.amount)>1e4?(e.errorAmount=!0,e.errorAmountMsg="Daily add cash limit is Rs 10000, Pls do varification of your KYC to increase limit.",!1):(o.addBalance={amount:t},e.closePopup("add_money"),e.closePopup("add_more_money"),void(window.location.href="paymentMethod?amount="+t)):(e.isWalletSubmitted=!0,!1)))},e.validateAmount=function(){return e.isWalletSubmitted=!1,e.errorAmount=!1,e.errorAmount="",e.amount.match(/^0[0-9].*$/)&&(e.amount=e.amount.replace(/^0+/,"")),parseFloat(amount)<parseInt(o.MinimumDepositAmount)?(e.errorAmount=!0,e.errorAmountMsg="Min limit of deposit amount is "+o.MinimumDepositAmount,!1):e.amount>1e4?(e.amount=1e4,e.errorAmount=!0,e.errorAmountMsg="Daily add cash limit is Rs 10000, Pls do varification of your KYC to increase limit.",!1):void 0},getQueryStringValue("amount")&&(e.amount=getQueryStringValue("amount")),e.payUReq=function(t){var a={};a.SessionKey=n.user_details.SessionKey,a.PaymentGateway="PayUmoney",a.RequestSource="Web",a.Amount=Number(e.amount),a.FirstName=n.user_details.FirstName,a.Email=n.user_details.Email,a.PhoneNumber=n.user_details.PhoneNumber,s.hasOwnProperty("CouponGUID")&&(a.CouponGUID=s.CouponGUID),e.isWalletSubmitted=!0,o.payUData={},i.callPostForm("wallet/add",a).then(function(t){if(200==t.ResponseCode)o.payUData=t.Data,setTimeout(function(){e.openBolt()},100);else if(500==t.ResponseCode){var a=l.warning("Update phone number to add money from settings.",{closeButton:!0});l.refreshTimer(a,5e3)}},function(e){if(500==e.ResponseCode){var o=l.warning("Update phone number to add money from settings.",{closeButton:!0});l.refreshTimer(o,5e3)}})},e.payTmReq=function(t){var a={};a.SessionKey=n.user_details.SessionKey,a.PaymentGateway="Paytm",a.RequestSource="Web",a.Amount=Number(e.amount),a.FirstName=n.user_details.FirstName,a.Email=n.user_details.Email,a.PhoneNumber=n.user_details.PhoneNumber,s.hasOwnProperty("CouponGUID")&&(a.CouponGUID=s.CouponGUID),e.isWalletSubmitted=!0,o.payData={},i.callPostForm("wallet/add",a).then(function(t){if(200==t.ResponseCode&&(o.payData=t.Data,e.MID=o.payData.MerchantID,e.ORDER_ID=o.payData.OrderID,e.CHANNEL_ID=o.payData.ChannelID,e.CHECKSUMHASH=o.payData.CheckSumHash,e.PAYTM_TXN_URL=o.payData.TransactionURL,e.CUST_ID=o.payData.CustomerID,e.INDUSTRY_TYPE_ID=o.payData.IndustryTypeID,e.WEBSITE=o.payData.Website,e.TXN_AMOUNT=o.payData.Amount,e.CALLBACK_URL=o.payData.CallbackURL,setTimeout(function(){e.submitPayTmData()},1e3),delete s.CouponGUID),500==t.ResponseCode){var a=l.warning("Update phone number to add money from user settings.",{closeButton:!0});l.refreshTimer(a,5e3),d(function(){window.location.href=base_url+"settings"},2e3)}if(502==t.ResponseCode){a=l.warning(t.Message,{closeButton:!0});l.refreshTimer(a,5e3),setTimeout(function(){localStorage.clear(),window.location.reload()},1e3)}},function(e){if(500==e.ResponseCode){var o=l.warning("Update phone number to add money from user settings.",{closeButton:!0});l.refreshTimer(o,5e3),d(function(){window.location.href=base_url+"settings"},2e3)}})},e.submitPayTmData=function(e){angular.element("#submitPayTm").trigger("submit")},e.addExtraCash=function(o){e.amount=parseFloat(e.amount)+parseFloat(o)},e.razorPayReq=function(t){var a={};a.SessionKey=n.user_details.SessionKey,a.PaymentGateway="Razorpay",a.RequestSource="Web",a.Amount=Number(e.amount),a.FirstName=n.user_details.FirstName,a.Email=n.user_details.Email,a.PhoneNumber=n.user_details.PhoneNumber,s.hasOwnProperty("CouponGUID")&&(a.CouponGUID=s.CouponGUID),e.isWalletSubmitted=!0,o.razorPayData={},i.callPostForm("wallet/add",a).then(function(o){if(200==o.ResponseCode){var t=o.Data;setTimeout(function(){var o={key:t.MerchantKey,amount:t.Amount,name:t.MerchantName,description:"Add funds",handler:function(o){e.razorPayTransactionHandler(o,t.OrderID,t.Amount)},prefill:{name:n.user_details.FirstName,email:n.user_details.Email,contact:n.user_details.PhoneNumber},notes:{UserID:n.user_details.UserID,OrderID:t.OrderID}};$.getScript("https://checkout.razorpay.com/v1/checkout.js",function(){new Razorpay(o).open()})},100)}else if(500==o.ResponseCode){var a=l.warning("Update phone number to add money from user settings.",{closeButton:!0});l.refreshTimer(a,5e3),d(function(){window.location.href=base_url+"settings"},2e3)}},function(e){if(500==e.ResponseCode){var o=l.warning("Update phone number to add money from user settings.",{closeButton:!0});l.refreshTimer(o,5e3),d(function(){window.location.href=base_url+"settings"},2e3)}})},e.razorPayTransactionHandler=function(e,o,t){var a={};a.SessionKey=n.user_details.SessionKey,a.PaymentGateway="Razorpay",a.PaymentGatewayResponse=JSON.stringify(e),a.PaymentGatewayStatus=status=e.razorpay_payment_id?"Success":"Failed",a.WalletID=o,a.Razor_payment_id=e.razorpay_payment_id,a.Amount=t,i.callPostForm("wallet/confirmWeb",a).then(function(e){if(200==e.ResponseCode){n.user_details.WalletAmount=parseFloat(e.Data.WalletAmount).toFixed(2),delete s.CouponGUID,"Cancelled"==status&&(window.location.href=base_url+"myAccount?status=Cancelled"),"Success"==status&&(window.location.href=base_url+"myAccount?status=Success");var o=l.success(e.Message,{closeButton:!0});l.refreshTimer(o,5e3)}else{window.location.href=base_url+"myAccount?status=Failed";o=l.error(e.Message,{closeButton:!0});l.refreshTimer(o,5e3)}},function(e){console.log("error",e)})},e.notificationList=[],e.getNotifications=function(){var o={};o.SessionKey=n.user_details.SessionKey,o.PageNo=1,o.PageSize=10,o.Status=1,i.callPostForm("notifications",o).then(function(o){if(e.getNotificationCount(),e.notificationList=[],200==o.ResponseCode&&o.Data.Records)o.Data.Records.forEach(o=>{o.isChecked=!1,e.notificationList.push(o)});else if(502==o.ResponseCode){var t=l.warning(o.Message,{closeButton:!0});l.refreshTimer(t,5e3),setTimeout(function(){localStorage.clear(),window.location.reload()},1e3)}},function(e){localStorage.clear()})},e.notificationCount=0,e.getNotificationCount=function(){var o={};o.SessionKey=n.user_details.SessionKey,i.callPostForm("notifications/getNotificationCount",o).then(function(o){if(200==o.ResponseCode)e.notificationCount=Number(o.Data.TotalUnread);else if(502==o.ResponseCode){var t=l.warning(o.Message,{closeButton:!0});l.refreshTimer(t,5e3),setTimeout(function(){localStorage.clear(),window.location.reload()},1e3)}},function(e){localStorage.clear()})},o.loader={},e.readNotification=function(t,a){var s={};s.SessionKey=n.user_details.SessionKey,s.NotificationID=t,o.loader.isLoading=!1,i.callPostForm("notifications/markRead",s).then(function(t){if(o.loader.isLoading=!0,200==t.ResponseCode)""!=a&&(n.SeriesGUID="",n.MatchGUID="",n.LeagueMatchGUID="",n.MatchGUID=a,localStorage.setItem("redirect_form_notify",!0),window.location.href=base_url+"lobby"),e.getNotifications();else if(502==t.ResponseCode){var s=l.warning(t.Message,{closeButton:!0});l.refreshTimer(s,5e3),setTimeout(function(){localStorage.clear(),window.location.reload()},1e3)}},function(e){o.loader.isLoading=!0})},e.logout=function(){var e={};e.SessionKey=n.user_details.SessionKey,i.callPostForm("signin/signout",e).then(function(e){200==e.ResponseCode&&(n.hasOwnProperty("SocialLogin")&&!0===n.SocialLogin&&(u.logout(),c.jsonp("https://accounts.google.com/logout")),localStorage.clear(),window.location.href=base_url)},function(e){localStorage.clear()})},e.selectAllNotification=function(o){e.notificationList.forEach(e=>{e.isChecked=o})},e.checkNotificationDeletionCount=function(){if(e.DeleteList=[],e.notificationList.forEach(o=>{o.isChecked&&e.DeleteList.push(o.NotificationID)}),0==e.DeleteList.length)return e.errorMessageShow("Please select atleast 1 notification to delete."),!1;confirm("Are you sure, you want to delete notification?")&&e.readAllNotification(e.DeleteList)},e.notificationSelect={},e.notificationSelect.selectAll=!1,e.readAllNotification=function(t){var a={};a.SessionKey=n.user_details.SessionKey,a.NotificationIDs=t,o.loader.isLoading=!1,c.post(e.env.api_url+"notifications/deleteAll",$.param(a),contentType).then(function(t){t=t.data;if(o.loader.isLoading=!0,200==t.ResponseCode)e.notificationSelect.selectAll=!1,e.getNotifications();else if(502==t.ResponseCode){var a=l.warning(t.Message,{closeButton:!0});l.refreshTimer(a,5e3),setTimeout(function(){localStorage.clear(),window.location.reload()},1e3)}})})}]),app.directive("addMoreCash",["$localStorage","$sessionStorage","appDB","$location","toastr",function(e,o,t,a,n){return{restrict:"E",controller:"headerController",templateUrl:"balance.php",link:function(a,s,i){a.openBolt=function(){bolt.launch({key:a.payUData.MerchantKey,txnid:a.payUData.TransactionID,hash:a.payUData.Hash,amount:a.payUData.Amount,firstname:a.payUData.FirstName,email:a.payUData.Email,phone:a.payUData.PhoneNumber,productinfo:a.payUData.ProductInfo.toString(),surl:a.payUData.SuccessURL,furl:a.payUData.FailedURL,lastname:"",curl:"",address1:"",address2:"",city:"",state:"",country:"",zipcode:"",udf1:"",udf2:"",udf3:"",udf4:"",udf5:"",pg:"",enforce_paymethod:"",expirytime:""},{responseHandler:function(s){if("SUCCESS"==s.response.txnStatus)var i="Success";else if("CANCEL"==s.response.txnStatus)i="Cancelled";else i="Failed";var r={SessionKey:e.user_details.SessionKey,PaymentGateway:"PayUmoney",PaymentGatewayStatus:i,WalletID:a.payUData.ProductInfo.toString(),PaymentGatewayResponse:JSON.stringify(s.response)};t.callPostForm("wallet/confirm",r).then(function(t){if(200==t.ResponseCode){e.user_details.WalletAmount=parseFloat(t.Data.WalletAmount).toFixed(2),delete o.CouponGUID,"Cancelled"==i&&(window.location.href=base_url+"myAccount?status=Cancelled"),"Success"==i&&(window.location.href=base_url+"myAccount?status=Success");var a=n.success(t.Message,{closeButton:!0});n.refreshTimer(a,5e3)}else{window.location.href=base_url+"myAccount?status=Failed";a=n.error(t.Message,{closeButton:!0});n.refreshTimer(a,5e3)}},function(e){console.log("error",e)})},catchException:function(e){alert(e.message)}})}}}}]),app.directive("addWithdrawalRequest",["$localStorage","$sessionStorage","appDB","$timeout","$rootScope","$location",function(e,o,t,a,n,s){return{restrict:"E",controller:"headerController",templateUrl:"WithdrawalRequest.php",link:function(o,s,i){o.test={},a(function(){o.test.amount=n.profileDetails.WinningAmount},1e3),o.withdrawSubmitted=!1,o.test.PaytmPhoneNumber=e.hasOwnProperty("user_details")?e.user_details.PhoneNumber:"",o.showOtp=!1,o.test.WithdrwalOTP="",o.withdrawRequest=function(a,n,s){if(o.helpers=Mobiweb.helpers,o.withdrawSubmitted=!0,!a.$valid)return!1;var i={};i.PaymentGateway=s,"Paytm"==s&&(i.PaytmPhoneNumber=o.test.PaytmPhoneNumber),i.Amount=n,i.SessionKey=e.user_details.SessionKey,i.UserGUID=e.user_details.UserGUID,t.callPostForm("wallet/withdrawal",i).then(function(e){o.checkResponseCode&&(o.withdrawSubmitted=!1,o.getWalletDetails(),o.closePopup("withdrawPopup"),o.successMessageShow(e.Message))},function(e){o.checkResponseCode(e)})},o.withdrawlConfirm=function(a,n,s){if(o.helpers=Mobiweb.helpers,o.withdrawSubmitted=!0,!a.$valid)return!1;var i={};i.WithdrawalID=o.WithdrawalID,i.OTP=n,i.PaymentGateway=s,i.SessionKey=e.user_details.SessionKey,i.PaytmPhoneNumber=o.PaytmPhoneNumber,i.Amount=o.WithdrawalAmount,t.callPostForm("wallet/withdrawal_confirm",i).then(function(e){o.checkResponseCode(e)&&("SUCCESS"==e.Data.paytmResponse.status?(o.successMessageShow("Withdrawal request sent successfully."),o.getWalletDetails()):o.errorMessageShow("Please try again, later"),o.closePopup("withdrawPopup"),o.showOtp=!1,delete o.WithdrawalID)},function(e){o.checkResponseCode(e)})}}}}]);